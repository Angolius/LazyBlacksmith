{% extends "base.html" %}

{% block title %}:: Manufacturing :: {{ blueprint.name }}{% endblock %}

{% block js %}
    <script>
        LazyBlacksmith.setLoader(LazyBlacksmith.blueprint.manufacturing);
        LazyBlacksmith.blueprint.manufacturing.systemUrls = "{{ url_for('ajax.solarsystems') }}";
        LazyBlacksmith.blueprint.manufacturing.materialBOM = "{{ url_for('ajax.blueprint_bom', blueprint_id=blueprint.id) }}";
        LazyBlacksmith.blueprint.manufacturing.tplSublistBlockUrl = "{{ url_for('template.manufacturing_sublist_block') }}";
        LazyBlacksmith.blueprint.manufacturing.tplSublistRowUrl = "{{ url_for('template.manufacturing_sublist_row') }}";
 
        LazyBlacksmith.blueprint.hasManufacturedComponent = {% if has_manufactured_components %}true{% else %}false{% endif %};
    </script>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <ul class="nav nav-tabs" role="tablist" id="bp-tabs">
            <li class="active"><a href="#tab-bp">Blueprint</a></li>
            {% if has_manufactured_components %}<li id='subcomp-tab'><a href="#tab-subcomp">Sub Components</a></li>{% endif %}
            <li id='summary-tab'><a href="#tab-summary">Summary</a></li>
        </ul>
        <div class="tab-content">
            <div class="row fade in active tab-pane" id="tab-bp">
                <div class="col-md-2">
                    <div class="well">
                        <div>
                            Facility<br>
                            <select name="facility" id="facility" class="form-control input-sm">
                                <option value="0" selected>Station</option>
                                <option value="1">Assembly Array</option>
                                <option value="2">Thukker Component Array</option>
                                <option value="3">Rapid Assembly Array</option>
                            </select>
                        </div>
                        <div>
                            Facility Tax<br>
                            <input id="tax" type="text" class="form-control input-sm" value="0.00">
                        </div>
                        <div>
                            System<br>
                            <input id="system" type="text" class="form-control input-sm typeahead" value="Jita">
                        </div>
                    </div>
                    <div class="well">
                        <div>
                            # Runs <br>
                            <input id="runs" type="text" class="form-control input-sm" value="1">
                        </div>
                        <div>
                            ME Level (<span id="ME-Level">0%</span>)<br>
                            <div id="ME"></div>
                        </div>
                        <div>
                            TE Level (<span id="TE-Level">0%</span>)<br>
                            <div id="TE"></div>
                        </div>
                    </div>
                </div>
                <div class="col-md-10 main-list">
                        {% if config.USE_CCP_ICONS -%}
                        <div class="pull-right">
                            <img src="{{ blueprint.icon_32() }}" alt="{{ blueprint.name }}">
                        </div>
                        {%- endif %}
                        <h4>
                            {{ blueprint.name }} <span class="small">({{ product.product.name }} x {{ product.quantity|intcomma }})<br>                            
                                <strong>Time per run: </strong><span data-time="{{ activity.time }}" class="time-per-run" data-id="{{ blueprint.id }}">{{ activity.time|duration }}</span> - 
                                <strong>Total time: </strong><span class="total-time" data-id="{{ blueprint.id }}">{{ activity.time|duration }}</span>
                            </span>
                        </h4>
                        <table class="table table-condensed materials-list table-hover table-striped">
                            <tr>
                                {% if config.USE_CCP_ICONS -%}<th>&nbsp;</th>{%- endif %}
                                <th>Name</th>
                                <th>Base Qty</th>
                                <th>Adjusted Qty</th>
                                <th>Job Qty</th>
                            </tr>
                        {% for material in materials.all() %}
                            <tr class="material" data-id="{{material.material.id}}" data-is-manufactured="{{- material.material.is_manufactured() -}}" data-qty="{{ material.quantity }}" data-qty-job="{{ material.quantity }}" data-qty-adj="{{ material.quantity }}" data-name="{{ material.material.name }}">

                                {% if config.USE_CCP_ICONS -%}
                                <td class="icon">
                                    <img src="{{ material.material.icon_32() }}" alt="{{ material.material.name }}">
                                </td>
                                {%- endif %}
                                <td>
                                    {{- material.material.name -}}
                                </td>
                                <td class="quantity" data-name="quantity">
                                    {{- material.quantity|intcomma -}}
                                </td>
                                <td class="quantity" data-name="quantity-adjusted">{{ material.quantity|intcomma }}</td>
                                <td class="quantity" data-name="quantity-job">{{ material.quantity|intcomma }}</td>
                            </tr>
                        {% endfor %}
                        </table>
                </div>
            </div>
            
            {% if has_manufactured_components %}
            <div class="row fade tab-pane" id="tab-subcomp">
                <strong>Loading materials... please wait a second</strong>
            </div>
            {% endif %} 
            
            <div class="row fade tab-pane" id="tab-summary">
                <strong>Loading materials... please wait a second</strong>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block modal %}
<div class="modal fade" role="dialog" id="subComponentBpConfigModal" aria-labelledby="subComponentBpConfigModal" aria-hidden="true" data-bp-id="">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="subComponentBpConfigModal">Configure blueprint <span id="componentModalBpName"></span></h4>
            </div>
            <div class="modal-body">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="well">
                                <div>
                                    Facility<br>
                                    <select name="modal-facility" id="modal-facility" class="form-control input-sm">
                                        <option value="0">Station</option>
                                        <option value="1">Assembly Array</option>
                                        <option value="2">Thukker Component Array</option>
                                        <option value="3">Rapid Assembly Array</option>
                                    </select>
                                </div>
                                <div>
                                    Facility Tax<br>
                                    <input id="modal-tax" type="text" class="form-control input-sm" value="0.00">
                                </div>
                                <div>
                                    System<br>
                                    <input id="modal-system" type="text" class="form-control input-sm typeahead" value="Jita">
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="well">
                                <div>
                                    ME Level (<span id="Modal-ME-Level">0%</span>)<br>
                                    <div id="ModalME"></div>
                                </div>
                                <div>
                                    TE Level (<span id="Modal-TE-Level">0%</span>)<br>
                                    <div id="ModalTE"></div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" id="modal-apply" data-dismiss="modal" class="btn btn-primary">Apply</button>
                <button type="button" id="modal-apply-all" data-dismiss="modal" class="btn btn-success">Apply to all blueprints</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}